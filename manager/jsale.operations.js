function updateClient(e){if(e>0){var t=$("#cmbClient").val(),a=$("#cmbClient option:selected").text(),i="idclient="+t+"&client="+a;$.ajax({type:"POST",url:"core/b-client.php",data:i,cache:!1,beforeSend:function(){$("#clientphone").text("Cargando..."),$("#clientciudad").text("Cargando..."),$("#clientaddress").text("Cargando...")},success:function(e){var t=jQuery.parseJSON(e);"true"===t.result?($("#clientphone").text(t.TELEFONOCLIENTE),$("#clientciudad").text(t.CIUDADCLIENTE),$("#clientaddress").text(t.DIRECCIONCLIENTE)):($("#clientphone").text("No encontrado"),$("#clientciudad").text("No encontrado"),$("#clientaddress").text("No encontrado"))}})}else $("#clientphone").text(""),$("#clientciudad").text(""),$("#clientaddress").text("")}function updateProduct(e){if(e>0){var t=$("#cmbProduct").val(),a=$("#cmbProduct option:selected").text(),i="idproduct="+t+"&product="+a;$.ajax({type:"POST",url:"core/b-product.php",data:i,cache:!1,beforeSend:function(){$("#value1product").text("Cargando..."),$("#value2product").text("Cargando...")},success:function(e){var t=jQuery.parseJSON(e);"true"===t.result?($("#value1product").text(t.VCONTADOINVENTARIO),$("#value2product").text(t.VCREDITOINVENTARIO)):($("#value1product").text("No encontrado"),$("#value2product").text("No encontrado"))}})}else $("#value1product").text(""),$("#value2product").text("")}function loadCategories(){$.ajax({type:"POST",url:"core/b-sale.php",data:"categories",cache:!1,success:function(e){var t=jQuery.parseJSON(e);t.result&&(sizeCategories=t.categories,limitsCategories=t.limits,namesCategories=t.names,cods=t.cods,$("#codinvoice").val(t.cods[0]))}})}function addItem(e){var t=$("#cmbProduct").val(),a=$("#quatity").val(),i=$("#cmbProduct option:selected").text(),l="",n="",r="",s="",c="",o=!0;if(""===a)return void printInvoiceMessage("warning","DEBES ESTABLECER LA CANTIDAD A LLEVAR");if(1>a)return void printInvoiceMessage("error","LA CANTIDAD DE NO PUEDE SER NEGATIVA");if(null==t)return void printInvoiceMessage("warning","DEBES SELECCIONAR UN PRODUCTO DE LA LISTA");if(void 0!=$("#fila_"+i).attr("id")){var d="idproduct="+t+"&product="+i;if($.ajax({type:"POST",async:!1,url:"core/b-product.php",data:d,cache:!1,success:function(e){var t=jQuery.parseJSON(e);if("true"===t.result){if(a*t.AREAPRODUCTO>sizeCategories[t.CATEGORIAPRODUCTO])o=!1;else{if(t.DISPONIBLEPRODUCTO=0)return;sizeCategories[t.CATEGORIAPRODUCTO]=sizeCategories[t.CATEGORIAPRODUCTO]-a*t.AREAPRODUCTO}l=t.REFERENCIAPRODUCTO,n=t.AREAPRODUCTO,""!=$("#value3product").val()?r=parseInt($("#value3product").val()):"CONTADO"===$("#paybill").text()?r=t.VCONTADOINVENTARIO:"CREDITO"===$("#paybill").text()&&(r=t.VCREDITOINVENTARIO,$("#statepaybill").text("PENDIENTE"))}else l="ERROR",n="ERROR",r="ERROR"}}),o===!0){s=n*r,c=a*s,$("#subvaluebill").val(parseInt($("#subvaluebill").val())+c),$("#valuebill").val(parseInt($("#subvaluebill").val())-parseInt($("#feevaluebill").val())-parseInt($("#discountbill").val())),a=parseInt(a)+parseInt($("#fila_"+i+" td:eq(1)").text()),quantitiesInvoice["id"+t]=a,valuesInvoice["id"+t]=r,s=n*r,c=a*s;var u="<tr id='fila_"+i+"' ><td>"+i+"</td><td>"+a+"</td><td>"+l+"</td><td>"+n+"</td><td>$ "+r+"</td><td>$ "+s+"</td><td>$ "+c+"</td></tr>";$("#fila_"+i).replaceWith(u),printInvoiceMessage("","EL PRODUCTO "+i+" FUE ACTUALIZADO")}else printInvoiceMessage("error","LA CANTIDAD "+a+" PRODUCTO DEL "+i+" ES MAYOR AL DISPONIBLE"+sizeCategories[1])}else{var d="idproduct="+t+"&product="+i;elementsInvoice["id"+t]=t,$.ajax({type:"POST",async:!1,url:"core/b-product.php",data:d,cache:!1,success:function(e){var t=jQuery.parseJSON(e);if("true"===t.result){if(a*t.AREAPRODUCTO>sizeCategories[t.CATEGORIAPRODUCTO])o=!1;else{if(t.DISPONIBLEPRODUCTO=0)return;sizeCategories[t.CATEGORIAPRODUCTO]=sizeCategories[t.CATEGORIAPRODUCTO]-a*t.AREAPRODUCTO}l=t.REFERENCIAPRODUCTO,n=t.AREAPRODUCTO,""!=$("#value3product").val()?r=parseInt($("#value3product").val()):"CONTADO"===$("#paybill").text()?r=t.VCONTADOINVENTARIO:"CREDITO"===$("#paybill").text()&&(r=t.VCREDITOINVENTARIO,$("#statepaybill").text("PENDIENTE"))}else l="ERROR",n="ERROR",r="ERROR"}}),o===!0?(quantitiesInvoice["id"+t]=a,valuesInvoice["id"+t]=r,s=n*r,c=a*s,$("#subvaluebill").val(parseInt($("#subvaluebill").val())+c),$("#valuebill").val(parseInt($("#subvaluebill").val())-parseInt($("#feevaluebill").val())-parseInt($("#discountbill").val())),$("#detailstable").last().append("<tr id='fila_"+i+"' ><td>"+i+"</td><td>"+a+"</td><td>"+l+"</td><td>"+n+"</td><td>$ "+r+"</td><td>$ "+s+"</td><td>$ "+c+"</td></tr>"),printInvoiceMessage("","EL PRODUCTO "+i+" FUE AGREGADO")):printInvoiceMessage("error","LA CANTIDAD "+a+" PRODUCTO DEL "+i+" ES MAYOR AL DISPONIBLE")}$("#quatity").val(""),$("#value3product").val(""),$("#cmbProduct").val(0),e.preventDefault}function printInvoiceMessage(e,t){$("#billmesage").html("warning"===e?"<span style='padding:3px;width: 100%; height:20px; background: url(shared/thumbs/bgwarning_lg.jpg);border-radius:10px;display:block' id='message'>"+t+"</span>":"error"===e?"<span style='color:white;padding:3px;width: 100%; height:20px; background: url(shared/thumbs/bgerror_lg.jpg);border-radius:10px;display:block' id='message'>"+t+"</span>":"<span style='padding:3px;width: 100%; height:20px; display:block;border-radius:10px' id='message'> "+t+"</span>"),setInterval(function(){$("#message").fadeOut()},1e4)}function delItem(e){var t=$("#cmbProduct").val(),a=$("#quatity").val(),i=$("#cmbProduct option:selected").text();if(void 0!=$("#fila_"+i).attr("id")&&""===a){delete elementsInvoice["id"+t];var l="idproduct="+t+"&product="+i;$.ajax({type:"POST",async:!1,url:"core/b-product.php",data:l,cache:!1,success:function(e){var t=jQuery.parseJSON(e);if("true"===t.result){if(t.DISPONIBLEPRODUCTO=0)return;sizeCategories[t.CATEGORIAPRODUCTO]=sizeCategories[t.CATEGORIAPRODUCTO]+parseInt($("#fila_"+i+" td:eq(1)").text())*t.AREAPRODUCTO}}}),delete quantitiesInvoice["id"+t],delete valuesInvoice["id"+t];var n=parseInt($("#fila_"+i+" td:eq(6)").text().substring(1));$("#subvaluebill").val(parseInt($("#subvaluebill").val())-n),$("#valuebill").val(parseInt($("#subvaluebill").val())-parseInt($("#feevaluebill").val())-parseInt($("#discountbill").val())),$("#fila_"+i).remove(),printInvoiceMessage("","EL PRODUCTO "+i+" FUE ELIMINADO DE LA FACTURA")}else if(void 0!=$("#fila_"+i).attr("id")&&""!=a)if(parseInt(a)<parseInt($("#fila_"+i+" td:eq(1)").text())){var r=a*parseInt($("#fila_"+i+" td:eq(5)").text().substring(1)),l="idproduct="+t+"&product="+i;$.ajax({type:"POST",async:!1,url:"core/b-product.php",data:l,cache:!1,success:function(e){var t=jQuery.parseJSON(e);if("true"===t.result){if(t.DISPONIBLEPRODUCTO=0)return;sizeCategories[t.CATEGORIAPRODUCTO]=sizeCategories[t.CATEGORIAPRODUCTO]+a*t.AREAPRODUCTO}}});var n=parseInt($("#fila_"+i+" td:eq(6)").text().substring(1))-r;a=parseInt($("#fila_"+i+" td:eq(1)").text())-parseInt(a),quantitiesInvoice["id"+t]=a,valuesInvoice["id"+t]=price;var s="<tr id='fila_"+i+"' ><td>"+i+"</td><td>"+a+"</td><td>"+$("#fila_"+i+" td:eq(2)").text()+"</td><td>"+$("#fila_"+i+" td:eq(3)").text()+"</td><td>$ "+$("#fila_"+i+" td:eq(4)").text().substring(1)+"</td><td>$ "+$("#fila_"+i+" td:eq(5)").text().substring(1)+"</td><td>$ "+n+"</td></tr>";$("#subvaluebill").val(parseInt($("#subvaluebill").val())-r),$("#valuebill").val(parseInt($("#subvaluebill").val())-parseInt($("#feevaluebill").val())-parseInt($("#discountbill").val())),$("#fila_"+i).replaceWith(s)}else printInvoiceMessage("error","LA CANTIDAD "+a+" A ELIMINAR DE EL PRODUCTO "+i+" ES MAYOR AL DE LA FACTURA");else null!=t?printInvoiceMessage("warning","EL PRODUCTO "+i+" NO ESTA EN LA FACTURA"):printInvoiceMessage("warning","NO HAY PRODUCTO SELECCIONADO");$("#quatity").val(""),$("#cmbProduct").val(0),e.preventDefault}function invoiceUpadteStock(){for(var e=sizeCategories[1],t=2;void 0!=sizeCategories[t];)e+="&"+sizeCategories[t],parseInt(sizeCategories[t])<parseInt(limitsCategories[t])&&($("#scrollingDiv").css("display","block"),$("#scrollingDiv h4").text("ADVERTENCIA"),$("#scrollingDiv #lowquanti").append("<span>La categoria <b>"+namesCategories[t]+"</b> ESTA POR ACABARSE <br/></span><br/>")),t++;$.ajax({type:"POST",url:"core/a-sale.php",data:{categories:JSON.stringify(e)},success:function(){}})}function invoiceSave(e){if(""!=$("#codinvoice").val()&&$("#detailstable").find("tbody tr").length>0){var t="",a="",i="";for(var l in elementsInvoice)elementsInvoice.hasOwnProperty(l)&&(t+="-"+elementsInvoice[l],a+="-"+quantitiesInvoice[l],i+="-"+valuesInvoice[l]);var n="dateinvoice="+$("#dateinvoice").text()+"&codinvoice="+$("#codinvoice").val()+"&idcostumer="+$("#cmbClient option:selected").index()+"&stateinvoice="+$("#statepaybill").text()+"&quantinvoice="+$("#valuebill").val()+"&valids="+i.substring(1)+"&ids="+t.substring(1)+"&qids="+a.substring(1)+"&duedate="+$("#datefee").val()+"&userid="+$("#nameuser").text()+"&typecod="+typecod+"&codincrement1="+(parseInt(cods[0])+1)+"&codincrement2="+(parseInt(cods[1])+1);alert(n),$.ajax({type:"POST",url:"core/a-sale.php",data:n,beforeSend:function(){},error:function(){},success:function(e){var t=jQuery.parseJSON(e);t.result&&(printInvoiceMessage("","FACRURA CREADA Y GUARDADA"),setTimeout(function(){$("#area").load("view/w-sale.php")},1e3))}}),invoiceUpadteStock(e)}else printInvoiceMessage("warning","NO HAY ELEMNETOS EN LA FACTURA O NO TIENE CODIGO ESTA FACTURA")}function invoicePrint(e){if(""!=$("#codinvoice").val()&&$("#detailstable").find("tbody tr").length>0){invoiceSave(e);var t=window.open("view/w-template.html","_blank","width=650, height=600,toolbar=0,menubar=0,resizable=0");t.onload=function(){t.document.getElementById("cliente").innerHTML=$("#cmbClient option:selected").text(),t.document.getElementById("direccion").innerHTML=$("#clientaddress").text(),t.document.getElementById("telefono").innerHTML=$("#clientphone").text(),t.document.getElementById("ciudad").innerHTML=$("#clientciudad").text(),t.document.getElementById("nfactura").innerHTML=$("#codinvoice").val(),t.document.getElementById("ffactura").innerHTML=$("#dateinvoice").text(),t.document.getElementById("pfactura").innerHTML=$("#paybill").text(),t.document.getElementById("esfactura").innerHTML=$("#statepaybill").text(),t.document.getElementById("sub").innerHTML="$ "+$("#subvaluebill").val(),t.document.getElementById("des").innerHTML="$ "+$("#discountbill").val(),t.document.getElementById("abon").innerHTML="$ "+$("#feevaluebill").val(),t.document.getElementById("total").innerHTML="$ "+$("#valuebill").val(),$("#detailstable tbody").clone().appendTo(t.document.getElementById("contenido")),t.document.getElementById("contenido").style.textAlign="center",t.print(),t.close()}}else printInvoiceMessage("warning","NO HAY ELEMNETOS EN LA FACTURA O NO TIENE CODIGO ESTA FACTURA")}var sizeCategories=Array(),limitsCategories=Array(),namesCategories=Array(),elementsInvoice=new Object,quantitiesInvoice=new Object,valuesInvoice=new Object,cods=new Array(2),typecod="";$(document).ready(function(){loadCategories()});var indexCod=1;$("#changecod").click(function(){indexCod%2==0?($("#icochange").attr("src","shared/thumbs/bton_invoice.png"),$("#codinvoice").val(cods[0]),typecod="CONSECUTIVOIVA"):($("#icochange").attr("src","shared/thumbs/btoff_invoice.png"),$("#codinvoice").val(cods[1]),typecod="CONSECUTIVO"),indexCod++}),$("#cmbClient").change(function(){updateClient($("#cmbClient").val())}),$("#cmbProduct").change(function(){updateProduct($("#cmbProduct").val()),$("#billmesage").text("")}),$("#discountbill").change(function(){$("#discountbill").val()>0?$("#valuebill").val(parseInt($("#subvaluebill").val())-parseInt($("#feevaluebill").val())-parseInt($("#discountbill").val())):($("#discountbill").val(0),$("#valuebill").val(parseInt($("#subvaluebill").val())-parseInt($("#feevaluebill").val())-parseInt($("#discountbill").val())))}),$("#feevaluebill").change(function(){$("#feevaluebill").val()>0?$("#valuebill").val(parseInt($("#subvaluebill").val())-parseInt($("#feevaluebill").val())-parseInt($("#discountbill").val())):($("#feevaluebill").val(0),$("#valuebill").val(parseInt($("#subvaluebill").val())-parseInt($("#feevaluebill").val())-parseInt($("#discountbill").val())))}),$("#quatity").on("input",function(){var e=$(this);$.isNumeric(e.val())||$(this).val("")}),$("#value3product").on("input",function(){var e=$(this);$.isNumeric(e.val())||$(this).val("")}),$("#codinvoice").on("input",function(){var e=$(this);$.isNumeric(e.val())?typecod="USERCOD":$(this).val("")}),$("#discountbill").on("input",function(){var e=$(this);$.isNumeric(e.val())||$(this).val(0)}),$("#feevaluebill").on("input",function(){var e=$(this);$.isNumeric(e.val())||$(this).val(0)}),$("#numinvoice").click(function(){$("#invoicediv").css("display","block")}),$("#typepay").click(function(){$("#feeform").css("display","block")}),$("#feeform #cancelfee").click(function(){$("#datefee").val($("#dateinvoice").text()),$("#paybill").text("CONTADO"),$("#statepaybill").text("CANCELADA"),$(this).parent().hide()}),$("#feeform #setdate").click(function(){$("#paybill").text("CREDITO"),$("#statepaybill").text("PENDIENTE"),$(this).parent().hide()});